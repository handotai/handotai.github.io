---
layout: post
title: Coool updates
abbrlink: 0a06f6d084344ac191635348ea27dc7c
tags: []
categories:
  - Dailies Journal
date: 1754434305174
updated: 1754463765604
---

# Today stuff

- Woooo I did some cool stuff last week
- I did a tour day so I visited like 5 apartments, and decided on two
  - We got accepted for one so we're hoping the other gets back to us soon
- Some great news though,
  - I finally finished fixing up my kindle offline library!!!!!!!!!
  - The big issue was that I had to use an ESP32 microcontroller to act as my softAP, since for some reason the dnsmasq on the raspberry pi 3a doesn't allow me to host captive website redirects, or it does it improperly
  - It isn't the most elegant solution since I wished it could be just on the pi 3 itself, but hey the offline library works with three components-
  - 1, jailbroken kindle to read books off, 2, a external library host machine (like a laptop or raspberry pi with calibre-server), and 3, a esp32 access point
  - Here were the steps I took:
    - 1. install esp32 script and flash to microcontroller on arduino IDE  (linked below this)
      2. setup pi3a with calibre, calibre-server, docker and nextcloud-desktop (I'm using nextcloud-desktop to grab books from my self hosted server and then using something like suwayomi to get extensions for mangas
      3. setup calibre library with empty metadata.db by running `calibre` on the pi, put library directory wherever but I put mine at root \~/Calibre Library (default)
      4. set host name configs on raspberry pi (b/c nextcloud is redirected from a pihole DNS change) inside sudo nano /etc/hosts to redirect my nextcloud + pihole server IP to domain properly and sync with nextcloud manga file folder (ex. 127.0.0.1 -> handotai.local)
      5. Also I assigned an IP to the calibre server, so i did `sudo ip addr add 192.168.4.7/24 dev wlan0` to reserve a slot and then ran calibre-server with parameters `--listen-on 192.168.4.7`. I also had to make sure calibre-server ran with systemd on startup.
      6. run both pi and esp32 powered on (power on esp32 and it will start hosting an AP), and ensure that you have KUAL + KOreader on the kindle, and connect them all to the Offline kindle library wifi
      7. Assuming you have books already on the raspberry pi, run a metadata sorting script (also linked below) to sort the books in series in the metadata of the calibre server
      8. run calibre-server, get the IP output and then connect to it via kindle using <http://192.168.blah.blah:8080/opds>, you will need to connect it via OPDS catalog option and that will be the URL to type in
      9. ???
      10. profit, you get your own offline kindle server!!!

ESP32 Script (flash via Arduino IDE, also I tested an ESP32-C3 and an ESP32-WROOM, the WROOM outbeats the transfer speed by 10x so use a slightly beefier one if you want faster downloads). Ignore the SPIFFS part in the script and just run as normal since that's deprecated and it can't be accessed via KOReader.

```arduino #include <WiFi.h>
#include <WebServer.h>
#include <DNSServer.h>

#define USE_SD false  // Set true to use SD card, false for SPIFFS

#if USE_SD
#include <SD.h>
#include <SPI.h>
#define SD_CS 10
#else
#include <SPIFFS.h>
#endif

const char* ssid = "OfflineKindleLibrary"; // change if u want
const char* password = "readbooks"; // change if u want

IPAddress apIP(192, 168, 4, 1);
DNSServer dns;
WebServer server(80);

void listFiles(File dir, String path = "") {
  while (File file = dir.openNextFile()) {
    if (!file.isDirectory()) {
      String filename = file.name();
      server.sendContent("<li><a href=\"/books" + filename + "\">" + filename + "</a></li>\n");
    }
    file.close();
  }
}

void handleRoot() {
  server.setContentLength(CONTENT_LENGTH_UNKNOWN);
  server.send(200, "text/html", "");
  server.sendContent("<html><body><h1>üìö Offline Kindle Library</h1><ul>");

  File root;
#if USE_SD
  root = SD.open("/books");
#else
  root = SPIFFS.open("/books");
#endif

  if (root && root.isDirectory()) {
    listFiles(root);
    root.close();
  } else {
    server.sendContent("<p>Error: /books folder not found.</p>");
  }

  server.sendContent("</ul></body></html>");
  server.client().stop();
}

void handleFileDownload() {
  String path = server.uri();
  path.remove(0, 6);  // remove "/books"

  File file;
#if USE_SD
  file = SD.open("/books" + path);
#else
  file = SPIFFS.open("/books" + path);
#endif

  if (!file || file.isDirectory()) {
    server.send(404, "text/plain", "File not found");
    return;
  }

  server.streamFile(file, "application/octet-stream");
  file.close();
}

// Fake success responses to trick Kindle
void handleSuccessCheck() {
  server.send(204, "text/plain", "");
}
void handleAnyRequest() {
  server.sendHeader("Location", "http://192.168.4.1/");
  server.send(302, "text/html", "");
}

void setup() {
  Serial.begin(115200);
  WiFi.softAPConfig(apIP, apIP, IPAddress(255, 255, 255, 0));
  WiFi.softAP(ssid, password);
  delay(500);

  dns.start(53, "*", apIP);  // Redirect all DNS requests to us

#if USE_SD
  if (!SD.begin(SD_CS)) {
    Serial.println("SD failed");
    return;
  }
#else
  if (!SPIFFS.begin(true)) {
    Serial.println("SPIFFS mount failed!");
    return;
  }
#endif

  // Route handlers
  server.on("/", handleRoot);
  server.on("/books", HTTP_GET, handleRoot);
  server.onNotFound([]() {
    if (server.uri().startsWith("/books/")) handleFileDownload();
    else handleAnyRequest();  // Redirect everything else
  });

  // Kindle/Amazon success check bypass
  server.on("/generate_204", HTTP_GET, handleSuccessCheck);
  server.on("/success.txt", HTTP_GET, handleSuccessCheck);
  server.on("/hotspot-detect.html", HTTP_GET, handleSuccessCheck);

  server.begin();
  Serial.println("Server started at 192.168.4.1");
}

void loop() {
  dns.processNextRequest();
  server.handleClient();
}
```

For importing series into the calibre library, make sure you have a format like this in your manga collection system on the pi:

```
Manga/
‚îî‚îÄ‚îÄ import_series.sh
‚îî‚îÄ‚îÄ 1Êó•Âæå„Å´Ê≠ª„Å¨„Ç¥„É™„É©/
    ‚îú‚îÄ‚îÄ Chapter 01.cbz
    ‚îú‚îÄ‚îÄ Chapter 02.cbz
```

then create a new script(i call it import\_series.sh), paste below code, chmod +x to make it runnable, and then execute it in the manga file directory. It will sort by series title and numerical order including decimals descending to that library folder to properly read it.

import\_series.sh

```bash
#!/bin/bash

IMPORT_DIR="${1:-$(dirname "$0")}"
CALIBRE_LIBRARY="/home/handotai/Calibre Library" // change directory to proper path

echo "üìÇ Scanning for series folders in: $IMPORT_DIR"

# Supported extensions grouped properly
for series_dir in "$IMPORT_DIR"/*/; do
    [[ -d "$series_dir" ]] || continue

    series_name=$(basename "$series_dir")
    echo "üìò Importing series: $series_name"

    # ‚¨ÖÔ∏è Correctly grouped -iname conditions inside escaped parentheses
    mapfile -t books < <(
        find "$series_dir" -maxdepth 1 -type f \( \
            -iname '*.cbz' -o \
            -iname '*.cbr' -o \
            -iname '*.epub' -o \
            -iname '*.pdf' -o \
            -iname '*.mobi' \
        \) | sort -V
    )

    if [[ ${#books[@]} -eq 0 ]]; then
        echo "‚ö†Ô∏è  No book files found in: $series_dir"
        continue
    fi

    index=1
    for book in "${books[@]}"; do
        book_filename=$(basename "$book")
        echo "  ‚ûï Importing [$index]: $book_filename"

        book_id=$(calibredb add "$book" --with-library="$CALIBRE_LIBRARY" 2>/dev/null | grep -oE 'book ids?: [0-9]+' | grep -oE '[0-9]+')

        if [[ -n "$book_id" ]]; then
            calibredb set_metadata "$book_id" \
                --with-library="$CALIBRE_LIBRARY" \
                --field series:"$series_name" \
                --field series_index:$index &>/dev/null
        else
            echo "  ‚ö†Ô∏è  Failed to import: $book_filename"
        fi

        ((index++))
    done
done

echo "‚úÖ All series imported and organized."
```

# JP

anki

- „Äå„Çà„Å§„Å∞ÔºÜÔºÅ„ÄçÔºöÁ¨¨ 2 Ë©±ÂÆåÊàê
- „Äå„Ç∏„Éß„Ç∏„Éß„ÅÆÂ•áÂ¶ô„Å™ÂÜíÈô∫Ôºö„Çπ„ÉÜ„Ç§„Çã„Éº„Åº„É´„Éº„É©„É≥„ÄçÔºöÁ¨¨ 2 Ë©±ÂÆåÊàê

¬†

# GUITAR

- Did a little bit of warmup practice a few days ago

  - - Trying to get back into doing one hour a day of getting haruka kanata down as a start
- Still looking for a vox amplug that is cheap and a cool looking pickguard (maybe a dark red tortoise shell pattern?)

¬†

# ENGINEERING

Tablet idea

- Need to print a modified case
  - Kinda scrapped bc I think the monitor has magnetic interference so I don't know how viable or how I can amplify the pickup signals

Nucdeck idea

- THE DREAM IS OVER!!!!!!!!!!
  - I began to realize that, after reading online with regards to eGPU bandwidth that non-NVME communication speeds will NOT work with my nuc, therefore the NUCdeck is dead
  - It is a sad day, but within the ashes a new idea comes up: Raspberry pideck
    - However this only works with AMD GPUs, I want to test my 1650 on the Pi 5 and see how it goes
    - I want to learn how to make drivers so I might try getting into helping this github out: <https://github.com/geerlingguy/raspberry-pi-pcie-devices>

Nixie tube pocketwatch idea

- Need to do model and pcb
- I bought a hotplate and a microsolder, I can try desoldering or testing which tube burnt out on the clock and look into making the pocketwatch

¬†

# FUTURE PLANS

- Add 10 a day of kanji mining if possible, if not just review more
- Create a schedule for doing workouts and also all my hobbies (programming, guitar, gaming, research)
